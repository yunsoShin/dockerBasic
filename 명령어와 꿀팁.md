# 도커 명령어와 옵션들

## `docker run`

컨테이너를 생성하고 실행합니다.

- `-d`: 백그라운드 모드에서 컨테이너 실행
- `-p [호스트 포트]:[컨테이너 포트]`: 호스트와 컨테이너의 포트를 연결
- `--name [이름]`: 컨테이너에 이름 부여
- `-e [환경변수=값]`: 컨테이너에 환경변수 설정
- `--rm`: 컨테이너 종료 시 자동으로 삭제
- `-v [호스트 디렉토리]:[컨테이너 디렉토리]`: 볼륨 마운트(데이터 유지)

**자주 사용되는 옵션 조합:**
웹서버 실행 시: `docker run -d -p 80:80 --name webserver nginx`
개발 환경에서의 사용: `docker run -it -v $(pwd):/app --name devcontainer node`

## `docker ps`

실행 중인 컨테이너를 보여줍니다.

- `-a`: 모든 컨테이너를 보여줌 (기본값은 실행 중인 컨테이너만)

## `docker stop`

실행 중인 컨테이너를 중지합니다.

## `docker rm`

컨테이너를 삭제합니다.

- `-f`: 실행 중인 컨테이너 강제 삭제

## `docker container prune`

정지해 있는 컨테이너를 모두 삭제하는 명령어

## `docker images`

로컬에 있는 이미지 목록을 보여줍니다.

- `-a`: 모든 이미지 보기 (기본값은 중간 이미지를 제외)
- `prune`:정지해 있는 이미지 모두 삭제

## `docker rmi`

이미지를 삭제합니다.

- `-f`: 사용 중인 이미지 강제 삭제

## `docker volume prune`

볼륨 삭제 명령어

## `docker system prune`

사용하지않는 이미지 , 컨테이너 삭제 명령어

- `-volumes`: 사용중이지않는 볼륨까지 모두 삭제

## `docker commit`

컨테이너에서 이미지를 생성한다

## `docker diff`

컨테이너 내의 변경사항을 출력한다

## `docker info`

도커 정보를 출력한다

## `docker inspect`

도커 이미지/컨테이너의 구성을 출력한다

## `docker build`

`Dockerfile`을 사용하여 이미지를 빌드합니다.

- `-t [이미지 이름]:[태그]`: 이미지에 태그 설정
- `--build-arg [변수=값]`: 빌드 시 변수 설정

## `docker logs`

컨테이너의 로그를 확인합니다.

- `-f`: 로그 지속적으로 보기

## `docker exec`

실행 중인 컨테이너 내에서 명령을 실행합니다.

- `-it`: 인터랙티브 모드(터미널)

## `docker network`

도커 네트워크와 관련된 작업을 수행합니다.

- `ls`: 네트워크 목록 보기
- `create [옵션] [네트워크 이름]`: 새로운 네트워크 생성

## `docker port`

컨테이너에서 공개한 모든 포트를 출력한다

## `COPY/ADD`

파일이나 디렉터리를 이미지의 파일시스템으로 복사한다

## `ENTRYPOINT`

컨테이너를 생성할 때 항상 실행할 애플리케이션을 정의한다.

## 도커 볼륨을 -v로 지정하는것이아닌 도커파일 내의 명령어로 지정하는 방법

```Dockerfile
FROM ubuntu:latest

# /host_directory 디렉토리를 볼륨으로 지정
VOLUME /host_directory

CMD ["/bin/bash"]
```

자세한 내용은
https://docs.docker.com/storage/volumes/

**각 옵션은 상황에 따라 다르게 조합하여 사용됩니다.**
예를 들어, 개발 환경을 구성할 때 로컬 디렉토리를 컨테이너에 마운트하는 `-v` 옵션과 인터랙티브 모드를 위한 `-it` 옵션이 자주 사용됩니다. 반면, 프로덕션 환경에서는 `-d` 옵션으로 백그라운드에서 서비스를 실행하고, `-p` 옵션으로 포트를 설정하는 경우가 많습니다.

## .dockerignore 파일 사용

프로젝트 디렉토리에 .dockerignore 파일을 생성하고 빌드에 불필요한 파일이나 디렉토리를 명시하여 이미지 크기를 줄이고 빌드 시간을 단축합니다.

## 멀티스테이지 빌드 사용

크기가 큰 빌드 단계를 가진 Dockerfile의 경우, 멀티스테이지 빌드를 사용하여 최종 이미지의 크기를 줄일 수 있습니다. 빌드 과정에서만 필요한 도구는 최종 이미지에 포함시키지 않고 중간 단계에서만 사용합니다.

## 적절한 베이스 이미지 선택

가능한 가벼운 베이스 이미지(예: alpine)를 사용하여 이미지 크기를 최소화하고 보안을 강화하세요. 불필요한 패키지가 없기 때문에 공격 표면도 줄어듭니다.

## 컨테이너 로깅 관리

docker logs 명령어를 통해 컨테이너의 로그를 확인할 수 있습니다. 복잡한 애플리케이션의 경우, 외부 로깅 드라이버(예: fluentd 또는 syslog)를 설정하여 로그를 중앙에서 관리하고 분석할 수 있습니다.

## docker-compose 사용

여러 컨테이너로 구성된 애플리케이션을 실행할 때 docker-compose를 사용하면 복잡한 옵션을 쉽게 관리하고 일관된 환경을 구성할 수 있습니다. docker-compose.yml 파일 하나로 여러 컨테이너의 구성과 네트워크, 볼륨을 정의할 수 있습니다.

## 헬스 체크 구현

Dockerfile에 HEALTHCHECK 지시어를 사용하여 컨테이너의 상태를 정기적으로 확인하고, 문제가 생겼을 때 알림을 받거나 자동으로 재시작하도록 설정할 수 있습니다.

## 명령어 별칭 설정

자주 사용하는 복잡한 도커 명령어를 간소화하기 위해 쉘의 별칭(alias) 기능을 사용하여 커맨드를 짧게 줄여 사용하세요. 예를 들어, docker ps -a를 dpsa로 줄일 수 있습니다.

# 도커 볼륨과 바인드 마운트의 차이점

도커 볼륨과 바인드 마운트는 모두 컨테이너의 데이터를 관리하고 영속화하는 방법이지만, 중요한 차이점이 있습니다.

## 도커 볼륨(Docker Volumes)

- 볼륨은 도커가 관리하는 호스트 파일 시스템의 일부입니다. 이것은 도커 호스트에 의해 완전히 관리되며, 사용자는 호스트 시스템의 특정 경로를 신경 쓸 필요가 없습니다.
- 볼륨은 컨테이너와 독립적이며, 컨테이너가 삭제되어도 데이터가 유지됩니다.
- 볼륨은 여러 컨테이너 간에 공유될 수 있고, 백업이나 마이그레이션이 용이합니다.
- 볼륨 드라이버를 사용하여 원격 호스트에 데이터를 저장할 수도 있습니다.

## 바인드 마운트(Bind Mounts)

- 바인드 마운트는 호스트 시스템의 특정 파일이나 디렉토리를 컨테이너에 직접 마운트하는 방법입니다. 이 경우, 사용자는 호스트의 정확한 경로를 지정해야 합니다.
- 바인드 마운트는 개발 과정에서 소스 코드와 같은 특정 데이터를 컨테이너에 실시간으로 반영해야 할 때 유용합니다.
- 호스트 시스템의 파일 시스템을 직접 사용하기 때문에 성능이 볼륨보다 빠를 수 있으나, 보안과 이식성 측면에서 제약이 있을 수 있습니다.

# 도커 네트워크의 다양한 유형과 각각의 사용 사례

## Bridge 네트워크

- 기본적으로 모든 도커 컨테이너는 bridge 네트워크에 연결됩니다. 이것은 컨테이너가 동일한 호스트 내에서 서로 통신할 수 있게 해줍니다.
- 일반적으로 개발 환경이나 단일 호스트에서 여러 컨테이너가 서로 통신해야 할 때 사용됩니다.

## Host 네트워크

- 호스트 네트워크를 사용하면 컨테이너가 호스트의 네트워크 스택을 직접 사용할 수 있습니다. 이는 네트워크 격리가 없으며 성능상의 이점을 제공할 수 있습니다.
- 네트워크 성능이 매우 중요하거나 호스트 시스템의 네트워크 설정을 그대로 사용해야 하는 경우에 유용합니다.

## Overlay 네트워크

- 다중 호스트 환경에서 컨테이너 간에 안전하게 통신을 할 수 있게 해주는 네트워크입니다. Swarm 클러스터와 같은 오케스트레이션 시스템과 함께 사용됩니다.
- 대규모 애플리케이션, 클라우드 환경, 또는 여러 서버가 필요한 환경에서 컨테이너 간의 통신을 관리할 때 사용됩니다.

# 도커 이미지를 최적화하는 과정에서 캐시를 효율적으로 사용하기 위한 전략

- **레이어 구조 이해하기**: 도커 이미지는 여러 레이어로 구성되어 있으며, 빌드 프로세스 중에 변경되지 않는 레이어는 캐시에서 재사용됩니다. 자주 변경되는 내용은 Dockerfile의 마지막 부분에 배치하여 캐시 효율을 높입니다.

- **명령어 결합**: `RUN`, `COPY`, `ADD` 같은 지시어는 새로운 레이어를 생성합니다. 관련된 명령어를 하나의 `RUN` 지시어로 결합하여 불필요한 레이어 생성을 줄입니다.

- **멀티스테이지 빌드**: 불필요한 도구나 파일이 최종 이미지에 포함되지 않도록 멀티스테이지 빌드를 사용합니다. 이를 통해 빌드 과정에서만 필요한 레이어는 캐시되고 최종 이미지에는 포함되지 않아 이미지 크기와 빌드 시간이 감소합니다.

- **.dockerignore 활용**: `.dockerignore` 파일을 사용하여 빌드 컨텍스트에서 불필요한 파일이나 디렉토리를 제외합니다. 이를 통해 빌드 속도를 높이고 캐시를 더 효율적으로 사용할 수 있습니다.
