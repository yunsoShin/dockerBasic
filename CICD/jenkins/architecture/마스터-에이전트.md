# 젠킨스 확장성: 마스터-에이전트 아키텍처의 깊은 이해

젠킨스(Jenkins)의 확장성은 지속적 통합과 지속적 배포의 성공에 중요한 역할을 합니다. 소프트웨어의 사용량이 증가함에 따라 시스템의 과부하 상태와 성능 저하 문제가 발생할 수 있습니다. 이러한 문제를 방지하기 위해 젠킨스의 확장 계획을 세워야 하는데, 여기에는 수직적 확장과 수평적 확장 두 가지 방법이 있습니다.

## 수직적 확장: 마스터의 자원 강화

수직적 확장은 마스터 시스템의 자원(램, CPU, 외장하드 등)을 추가하는 방식입니다. 신규 프로젝트가 생길 때마다 필요한 자원을 증가시키는 것이죠. 이 방법은 간단하고 효과적일 수 있지만, 확장의 한계에 직면할 수 있습니다.

### 장점:

1. 모든 업그레이드, 스크립트, 보안 설정, 사용자 및 플러그인 관리가 한 곳에서 이루어집니다.
2. 관리가 비교적 단순하고 직관적입니다.

### 단점:

1. 자원의 물리적 한계에 도달할 수 있습니다.
2. 마스터 서버에 문제가 발생하면 전체 시스템에 영향을 미칠 수 있습니다.

## 수평적 확장: 마스터 인스턴스의 증가

수평적 확장은 조직이 성장함에 따라 마스터 인스턴스의 수를 늘리는 방식입니다. 이는 각 팀마다 별도의 마스터 인스턴스를 두는 것을 의미할 수도 있습니다.

### 장점:

1. 마스터 역할을 하는 컴퓨터가 고사양일 필요가 없습니다.
2. 팀별로 고유한 설정을 할 수 있어 맞춤형 환경을 구성할 수 있습니다.
3. 각 팀별 전용 마스터 인스턴스가 있어 업무 효율이 증가합니다.
4. 한 마스터 인스턴스에 문제가 발생해도 다른 팀에 영향을 미치지 않습니다.
5. 인프라를 표준화하고 필수 인프라로 구분하여 관리할 수 있습니다.

### 단점:

1. 프로젝트 간 통합 자동화가 어렵습니다.
2. 각 팀마다 젠킨스 인스턴스를 유지 관리해야 하는 부담이 있습니다.

## 파이프라인 테스트와 고가용성

젠킨스의 파이프라인 정의 테스트는 중요합니다. 새로운 젠킨스 업그레이드나 플러그인이 출시될 때마다 이를 검증해야 합니다. 젠킨스 시스템은 소프트웨어의 품질을 보장하고 지속적인 통합 및 배포 프로세스에서 중요한 역할을 하므로, 테스트와 프로덕션 환경을 분리하여 운영하는 것이 필수적입니다.

### 테스트 인스턴스와 프로덕션 인스턴스

- 테스트 인스턴스는 새로운 업그레이드와 플러그인을 검증하는 데 사용됩니다.
- 프로덕션 인스턴스는 실제 운영 환경에서 사용되며, 높은 안정성과 가용성을 요구합니다.

---

# 젠킨스 마스터-에이전트 아키텍처: 통신 프로토콜부터 원격 에이전트 구성까지

젠킨스(Jenkins)의 마스터-에이전트 아키텍처는 복잡한 빌드 환경에서 매우 중요한 역할을 합니다. 이 구조에서 마스터는 작업을 관리하고, 에이전트는 실제 빌드 작업을 수행합니다. 이번 글에서는 마스터와 에이전트 간의 통신 프로토콜, 에이전트의 설정 방법, 그리고 원격 에이전트 구성에 대해 자세히 살펴보겠습니다.

## 통신 프로토콜

젠킨스 마스터와 에이전트 간의 통신은 주로 Java Network Launch Protocol(JNLP), SSH, 또는 DCOM(Windows 전용)을 사용합니다. 각각의 프로토콜은 다음과 같은 특성을 가집니다.

### JNLP

- Java 기반의 프로토콜로, 주로 윈도우 환경에서 사용됩니다.
- 방화벽 뒤에 있는 에이전트를 연결하는 데 유용합니다.
- 웹 브라우저를 통해 에이전트를 실행할 수 있습니다.

### SSH

- 보안이 강화된 프로토콜로, 리눅스 및 유닉스 환경에서 주로 사용됩니다.
- 마스터와 에이전트 간의 안전한 통신을 보장합니다.

### DCOM

- 윈도우 전용 프로토콜로, 주로 윈도우 네트워크에서 사용됩니다.
- 네트워크 상의 다른 컴퓨터와 통신할 때 사용됩니다.

## 에이전트 설정

젠킨스 에이전트를 설정하는 과정은 마스터 서버에서 진행됩니다. 에이전트를 추가하려면 젠킨스 대시보드에서 '노드 관리'로 이동한 후 '새 노드 추가'를 선택합니다. 여기서 에이전트의 이름을 지정하고, 원하는 설정을 구성할 수 있습니다.

### 설정 옵션

- **# of executors**: 동시에 수행할 수 있는 작업의 수를 지정합니다.
- **Remote root directory**: 에이전트에서 작업을 저장할 디렉토리의 경로입니다.
- **Labels**: 작업을 할당할 때 사용되는 에이전트의 라벨입니다.
- **Usage**: 이 에이전트가 어떻게 사용될지를 결정합니다 (예: 독점적으로 사용, 특정 작업에만 사용 등).
- **Launch method**: 에이전트를 시작하는 방법 (JNLP, SSH 등).

## 원격 에이전트 구성

원격 에이전트 구성은 마스터 서버가 아닌 다른 컴퓨터에서 빌드 작업을 수행하도록 하는 것입니다. 이는 다양한 운영 체제 또는 다른 환경에서의 빌드를 가능하게 합니다.

### 구성 방법

1. **에이전트 추가**: 마스터 서버에서 '노드 관리'를 통해 새로운 에이전트를 추가합니다.
2. **통신 프로토콜 설정**: JNLP, SSH, DCOM 중에서 선택합니다.
3. **에이전트 머신 설정**: 에이전트가 실행될 머신에서 필요한 Java 또는 기타 환경을 설정합니다.
4. **연결**: 설정한 프로토콜에 따라 마스터와 에이전트를 연결합니다.

## 영구 에이전트 이해하기

다중 에이전트를 이해하기 위해서는 각각의 레이블의 비지니스 로직에 의한 처리와 앞서 언급한 도커의 이해에서 설명했던 것 처럼 다중 프로덕션 서버를 유지할 때 겪게 되는 문제를 파악 할 필요가 있다.

잎선 도커의 다중프로덕션서버에서의 문제는 프로덕션 서버에 도커엔진을 설치해 해당 문제를 해결했다. 젠킨스도 이와같이 문제가 해결 가능하다.

### 영구 도커 호스트 에이전트 이해하기

해당 솔루션의 기본적인 개념은 범용에이전트를 영구적으로 추가하는것에 있다, 각각의 에이전트는 모두 도커엔진이 탑재되어 모두가 동일하게 구성되고 각 빌드는 빌드가 실행될 도커 이미지에 따라 정의된다.

## 영구 도커 호스트 에이전트 구성해보기

해당 구성도 정적인 방식이므로 앞에서 했던 영구 에이전트 방식과 동일하다
차이점이 있다면 각 에이전트에 사용할 시스템 도커를 설치해야한다는 것이다. 또한 모든 에이전트가 동일 할 수 있기 때문에 레이블이 필수적이진않다. 에이전트를 구성한 이후에는 각 파이프라인 스크립트에서 도커이미지를 정의한다.

빌드 구성이 시작되면 젠킨스 에이전트는 도커이미지에서 컨테이너를 실행하게되고 , 컨테이너에서 모든 파이프라인 스텝을 실행한다. 이 방식에서 사용자는 항상 실행환경을 알고 있기 때문에 특정 프로젝트 유형에 따라 각기 에이전트를 구성하지 않아도 된다.\

### 이전의 기초적인 영구 에이전트 파이프라인

```
pipeline {
    agent any
    stages {
        stage('Hello') {
            steps {
                echo 'Hello World!'
            }
        }
    }
}

```

### 도커를 활용한 영구 에이전트 파이프라인.

```
pipeline {
    agent none
    stages {
        stage('Build') {
            agent {
                docker { image 'node:12-alpine' }
            }
            steps {
                sh 'node --version'
                // 여기에 빌드 스크립트를 추가합니다.
            }
        }
    }
}

```

노드 버전이 12버전인 이미지를 실행하고 빌드 스텝에 추가하는 파이프라인을 구축합니다.

## 젠킨스 스웜 에이전트: 동적 에이전트 관리의 이해

젠킨스 스웜은 CI/CD 파이프라인에서 에이전트를 동적으로 관리하는 강력한 방법을 제공합니다. 이 시스템은 사용자가 특정 에이전트나 도커 기반 에이전트를 자유롭게 사용할 수 있도록 설계되었습니다.

### 스웜 에이전트의 동작 원리

젠킨스 스웜은 마스터-에이전트 구조에서 에이전트의 설정을 마스터에서 에이전트로 이동시키는 방식을 채택합니다. 이 과정은 수작업으로 이루어지며, 쿠버네티스나 도커 스웜과 같은 클러스터링 시스템과 결합될 때, 서버 클러스터 내에서 에이전트를 동적으로 확장하는 기능을 제공합니다.

### 사용 시기

- **다수의 에이전트 확장 및 관리 필요 시**: 젠킨스 스웜은 많은 수의 에이전트를 빠르게 확장하고 관리하는 데 유용합니다.
- **다양한 환경에서의 에이전트 실행**: 다른 운영 체제에서 에이전트를 실행할 수 있습니다.
- **동적 수요 변화에 대응**: 피크 시간에만 많은 에이전트가 필요한 경우에 적합합니다.

### 장점

- **동적 확장성**: 필요에 따라 자동으로 에이전트를 추가하거나 제거할 수 있습니다.
- **간편한 관리**: 중앙 집중식 관리가 필요 없으며, 각 에이전트는 독립적으로 작동합니다.
- **다양한 환경 지원**: 다양한 운영 체제 및 환경에서 에이전트를 실행할 수 있습니다.

### 단점

- **네트워크 의존성**: 젠킨스 마스터와의 연결이 중단되면 에이전트가 작동하지 않을 수 있습니다.
- **보안 고려사항**: 외부에서 접근 가능한 에이전트는 보안 설정에 주의해야 합니다.
- **리소스 관리**: 많은 수의 에이전트를 관리할 때 리소스 사용량을 주의 깊게 모니터링해야 합니다.

### 기술적 깊이 추가

젠킨스 스웜 에이전트의 설정과 관리는 다음과 같은 기술적 고려사항을 포함합니다:

#### 에이전트 설정

에이전트를 설정할 때는 다음과 같은 사항을 고려해야 합니다:

- **에이전트의 운영 체제**: 다양한 운영 체제를 지원하는 에이전트를 선택할 수 있습니다.
- **네트워크 설정**: 에이전트와 젠킨스 마스터 간의 안정적인 네트워크 연결이 필요합니다.
- **보안 설정**: 에이전트의 보안을 위해 적절한 방화벽 및 액세스 제어를 설정해야 합니다.

#### 리소스 관리

에이전트의 리소스 사용량을 모니터링하고, 필요에 따라 조정하는 것이 중요합니다:

- **CPU 및 메모리 사용량**: 각 에이전트의 성능을 최적화하기 위해 CPU 및 메모리 사용량을 모니터링합니다.
- **스토리지 요구사항**: 충분한 스토리지 공간을 확보하여 에이전트의 안정적인 작동을 보장합니다.

젠킨스 스웜 에이전트는 확장성과 유연성이 중요한 환경에서 효과적인 솔루션을 제공합니다. 그러나 네트워크 의존성과 보안 문제에 대한 충분한 대비가 필요합니다.

---

#### 동적 프로비저닝 도커 에이전트

```
    FROM jenkins/agent
    USER root
    RUN apt-get update && \
        apt-get install -y ruby
    USER jenkins
```
